let menu = [
  { id: 1, name: "Caramel Latte (12oz)", price: 85, category: "drinks" },
  { id: 2, name: "Caramel Latte (16oz)", price: 110, category: "drinks" },
  { id: 3, name: "Caramel Latte (22oz)", price: 139, category: "drinks" },

  { id: 4, name: "Americano Sunrise (12oz)", price: 95, category: "drinks" },
  { id: 5, name: "Americano Sunrise (16oz)", price: 125, category: "drinks" },
  { id: 6, name: "Americano Sunrise (22oz)", price: 145, category: "drinks" },

  { id: 7, name: "Cinnamon Latte (12oz)", price: 95, category: "drinks" },
  { id: 8, name: "Cinnamon Latte (16oz)", price: 110, category: "drinks" },
  { id: 9, name: "Cinnamon Latte (22oz)", price: 139, category: "drinks" },

  { id: 10, name: "Spanish Latte (12oz)", price: 95, category: "drinks" },
  { id: 11, name: "Spanish Latte (16oz)", price: 125, category: "drinks" },
  { id: 12, name: "Spanish Latte (22oz)", price: 145, category: "drinks" },

  { id: 13, name: "Mocha Latte (12oz)", price: 85, category: "drinks" },
  { id: 14, name: "Mocha Latte (16oz)", price: 110, category: "drinks" },
  { id: 15, name: "Mocha Latte (22oz)", price: 139, category: "drinks" },

  { id: 16, name: "Kape-densada (12oz)", price: 85, category: "drinks" },
  { id: 17, name: "Kape-densada (16oz)", price: 110, category: "drinks" },
  { id: 18, name: "Kape-densada (22oz)", price: 139, category: "drinks" },

  { id: 19, name: "Matcha Espresso (12oz)", price: 95, category: "drinks" },
  { id: 20, name: "Matcha Espresso (16oz)", price: 125, category: "drinks" },
  { id: 21, name: "Matcha Espresso (22oz)", price: 145, category: "drinks" },

  { id: 22, name: "Matcha Latte (12oz)", price: 90, category: "drinks" },
  { id: 23, name: "Matcha Latte (16oz)", price: 110, category: "drinks" },
  { id: 24, name: "Matcha Latte (22oz)", price: 139, category: "drinks" },

  { id: 25, name: "Blueberry Matcha (16oz)", price: 139, category: "drinks" },
  { id: 26, name: "Blueberry Matcha (22oz)", price: 159, category: "drinks" },

  { id: 27, name: "Strawberry Matcha (16oz)", price: 139, category: "drinks" },
  { id: 28, name: "Strawberry Matcha (22oz)", price: 159, category: "drinks" },

  { id: 29, name: "Mango Matcha (16oz)", price: 139, category: "drinks" },
  { id: 30, name: "Mango Matcha (22oz)", price: 159, category: "drinks" },

  {
    id: 31,
    name: "Strawberry Fruit Tea (16oz)",
    price: 65,
    category: "drinks",
  },
  {
    id: 32,
    name: "Strawberry Fruit Tea (22oz)",
    price: 80,
    category: "drinks",
  },

  { id: 33, name: "Passion Fruit Tea (16oz)", price: 75, category: "drinks" },
  { id: 34, name: "Passion Fruit Tea (22oz)", price: 90, category: "drinks" },

  {
    id: 35,
    name: "Lychee Blueberry Tea (16oz)",
    price: 75,
    category: "drinks",
  },
  {
    id: 36,
    name: "Lychee Blueberry Tea (22oz)",
    price: 90,
    category: "drinks",
  },

  { id: 37, name: "Peach Mango Tea (16oz)", price: 75, category: "drinks" },
  { id: 38, name: "Peach Mango Tea (22oz)", price: 90, category: "drinks" },

  { id: 39, name: "Green Apple Tea (16oz)", price: 65, category: "drinks" },
  { id: 40, name: "Green Apple Tea (22oz)", price: 80, category: "drinks" },

  { id: 41, name: "Kiwi Tea (16oz)", price: 65, category: "drinks" },
  { id: 42, name: "Kiwi Tea (22oz)", price: 80, category: "drinks" },

  { id: 43, name: "Yakult Strawberry (16oz)", price: 110, category: "drinks" },
  { id: 44, name: "Yakult Strawberry (22oz)", price: 134, category: "drinks" },

  { id: 45, name: "Yakult Blueberry (16oz)", price: 110, category: "drinks" },
  { id: 46, name: "Yakult Blueberry (22oz)", price: 134, category: "drinks" },

  {
    id: 47,
    name: "Yakult Passion Fruit (16oz)",
    price: 110,
    category: "drinks",
  },
  {
    id: 48,
    name: "Yakult Passion Fruit (22oz)",
    price: 134,
    category: "drinks",
  },

  { id: 49, name: "Yakult Lemon (16oz)", price: 110, category: "drinks" },
  { id: 50, name: "Yakult Lemon (22oz)", price: 134, category: "drinks" },

  { id: 51, name: "Nachos", price: 79, category: "snacks" },
  { id: 52, name: "Fries", price: 49, category: "snacks" },
  { id: 53, name: "Nuggets (7pcs)", price: 65, category: "snacks" },
  { id: 54, name: "PB Meryenda Set", price: 170, category: "snacks" },

  { id: 55, name: "Crossfles Biscoff", price: 130, category: "snacks" },
  { id: 56, name: "Crossfles Banana Caramel", price: 130, category: "snacks" },
  { id: 57, name: "Crossfles Oreo", price: 130, category: "snacks" },

  { id: 58, name: "Hash Brown", price: 30, category: "snacks" },
  { id: 59, name: "Pansit Canton", price: 35, category: "snacks" },

  { id: 60, name: "Buldak Carbonara", price: 125, category: "snacks" },
  { id: 61, name: "Buldak Cheese", price: 125, category: "snacks" },
  { id: 62, name: "Shin Ramyun", price: 125, category: "snacks" },

  { id: 63, name: "Nata", price: 10, category: "addons" },
  { id: 64, name: "Fruit Jelly", price: 10, category: "addons" },
  { id: 65, name: "Yakult Add-on", price: 25, category: "addons" },
];

let order = [];
let currentCategory = "drinks";
let currentPage = 1;
let orderType = "Dine-In";
const itemsPerPage = 9;

window.onload = () => {
  renderMenu();
  renderMaintenanceList();
};

// 1. MENU RENDER
function renderMenu() {
  const container = document.getElementById("menuItems");
  const filtered = menu.filter((item) => item.category === currentCategory);
  const totalPages = Math.ceil(filtered.length / itemsPerPage);
  const start = (currentPage - 1) * itemsPerPage;
  const paginatedItems = filtered.slice(start, start + itemsPerPage);

  container.innerHTML = "";
  paginatedItems.forEach((item) => {
    container.innerHTML += `
            <button class="menu-item-btn" onclick="addToOrder(${
              item.id
            })" style="transition: none !important; transform: none !important; cursor: pointer;">
                <strong>${item.name}</strong>
                <span class="menu-price">₱${item.price.toFixed(2)}</span>
            </button>`;
  });

  document.getElementById("pageDisplay").innerText = `Page ${currentPage} of ${
    totalPages || 1
  }`;
  document.getElementById("prevBtn").disabled = currentPage === 1;
  document.getElementById("nextBtn").disabled = currentPage >= totalPages;
}

// 2. ORDER LOGIC
function addToOrder(id) {
  const item = menu.find((m) => m.id === id);
  const existing = order.find((o) => o.id === id);
  if (existing) {
    existing.qty++;
  } else {
    order.push({ ...item, qty: 1 });
  }
  renderOrder();
}

function renderOrder() {
  const list = document.getElementById("orderList");
  let subtotal = 0;
  list.innerHTML = "";

  order.forEach((item) => {
    const itemTotal = item.price * item.qty;
    subtotal += itemTotal;
    list.innerHTML += `
            <div class="order-item" style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ccc;">
                <div><strong>${item.name}</strong><br><small>₱${
      item.price
    }</small></div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="qty-btn" onclick="updateQty(${
                      item.id
                    }, -1)">-</button>
                    <span>${item.qty}</span>
                    <button class="qty-btn" onclick="updateQty(${
                      item.id
                    }, 1)">+</button>
                </div>
                <div>₱${itemTotal.toFixed(2)}</div>
            </div>`;
  });

  const tax = subtotal * 0.06;
  const total = subtotal + tax;

  document.getElementById("subtotalDisplay").innerText = `₱${subtotal.toFixed(
    2
  )}`;
  document.getElementById("taxDisplay").innerText = `₱${tax.toFixed(2)}`;
  document.getElementById("totalDisplay").innerText = `₱${total.toFixed(2)}`;
}


// 3. MAINTENANCE LOGIC
function renderMaintenanceList() {
  const dropdown = document.getElementById("deleteDropdown");
  if (!dropdown) return;

  dropdown.innerHTML = '<option value="">-- Select Item to Delete --</option>';
  const sortedMenu = [...menu].sort((a, b) =>
    a.category.localeCompare(b.category)
  );

  sortedMenu.forEach((item) => {
    dropdown.innerHTML += `
            <option value="${item.id}">[${item.category.toUpperCase()}] ${
      item.name
    } - ₱${item.price.toFixed(2)}</option>`;
  });
}

function addItem() {
  const n = document.getElementById("itemName").value;
  const p = document.getElementById("itemPrice").value;
  const c = document.getElementById("itemCat").value;

  // Validation Check
  if (n.trim() === "" || p.trim() === "") {
    alert("Please fill in name and price.");
    return;
  }

  // Add to Array
  menu.push({ id: Date.now(), name: n, price: parseFloat(p), category: c });

  // Refresh UI
  renderMenu();
  renderMaintenanceList();

  // Show Success Message
  const successMsg = document.getElementById("successMsg");
  if (successMsg) {
    successMsg.innerText = "Item added successfully!";
    successMsg.style.display = "block";
    setTimeout(() => {
      successMsg.style.display = "none";
    }, 2000);
  } else {
    alert("Item added successfully!");
  }

  // Clear Inputs
  document.getElementById("itemName").value = "";
  document.getElementById("itemPrice").value = "";
}

function deleteItemSelected() {
  const dropdown = document.getElementById("deleteDropdown");
  const selectedId = dropdown.value;

  if (!selectedId) {
    alert("Pumili muna ng item na buburahin.");
    return;
  }

  const itemToDelete = menu.find((m) => m.id == selectedId);

  if (confirm(`Are you sure to delete ${itemToDelete.name} at the menu?`)) {
    menu = menu.filter((m) => m.id != selectedId);
    renderMenu();
    renderMaintenanceList();
    alert("Item deleted successfully!");
  }
}

// 4. PLACE ORDER
function placeOrder() {
  if (order.length === 0) {
    alert("Pumili muna ng items bago mag-order!");
    return;
  }
  alert("Order Successful! Proceeding to pring receipt...");
  window.print();
  // clearOrder(); // Optional: i-uncomment kung gusto mo ma-clear ang cart after order
}

// 5. HELPERS
function openMaintenance() {
  renderMaintenanceList();
  document.getElementById("maintenanceModal").style.display = "flex";
}

function closeMaintenance() {
  document.getElementById("maintenanceModal").style.display = "none";
}

function updateQty(id, delta) {
  const item = order.find((o) => o.id === id);
  if (item) {
    item.qty += delta;
    if (item.qty <= 0) order = order.filter((o) => o.id !== id);
  }
  renderOrder();
}

function setCategory(cat, e) {
  currentCategory = cat;
  currentPage = 1;
  document
    .querySelectorAll(".tab-btn")
    .forEach((b) => b.classList.remove("active"));
  e.target.classList.add("active");
  renderMenu();
}

function changePage(s) {
  currentPage += s;
  renderMenu();
}

function clearOrder() {
  order = [];
  renderOrder();
}

function setOrderType(t, e) {
  orderType = t;
  document.getElementById("modeDisplay").innerText = t;
  document
    .querySelectorAll(".type-btn")
    .forEach((b) => b.classList.remove("active"));
  e.target.classList.add("active");
}
